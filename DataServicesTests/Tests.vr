Using System
Using System.Text
Using System.Collections.Generic
Using Microsoft.VisualStudio.TestTools.UnitTesting
Using System.IO 
Using ASNA.DataGate.Client

// Set reference to Microsoft.VisualStudio.QualityTools.UnitTestFramework

// DclNamespace DataServicesTests

// Project template location:
// "C:\Users\Roger\Documents\Visual Studio 2012\My Exported Templates\AVR unit test project.zip"

BegClass Tests Access(*Public) Attributes(TestClass())

    DclDb pgmDB DBName("*Public/DG Net Local") 

    BegSr TestDataServiceCustomers Attributes(TestMethod()) Access(*Public)
        DclFld Parms    Type(Dictionary(*Of *String,*String)) New()
        DclFld DGList   Type(ASNA.Helpers.DataServices.DataList)
        DclFld json     Type(*String)
        DclFld Result   Type(*Boolean) 
        DclFld Rows     Type(*Integer4)

        Parms.Add("library","Examples")
        Parms.Add("file","CMastNewL2")
        Parms.Add("fields","CMCUSTNO:label,CMNAME:text,CMADDR1,CMCITY,CMState,CMPostCode")
        Parms.Add("rows","12")

        Connect pgmDB 

        Rows = Convert.ToInt32(Parms["rows"])
        DGList = *New ASNA.Helpers.DataServices.DataList(pgmDB.Connection,Parms["library"],parms["file"],parms["fields"],Rows)
        DGList.AddKey("CMNAME","Smi")
        DGList.AddKey("CMCUSTNO","30000")
        DGList.Query = "CMNAME >= '{CMNAME}' AND CMCUSTNO >= {CMCUSTNO}" 
       
        Result = DGList.GetList()
        Assert.IsTrue(Result)  
        If (Result) 
            // Success.
        Else 
            // An error occurred.
        EndIf

        Disconnect pgmDB

        json = DGList.ListAsJson

        File.WriteAllText("c:\users\roger\documents\customers.json",json)

        Assert.AreEqual(DGList.ResultRowCount,Convert.ToInt32(12))
    EndSr 

    BegSr TestDataServiceCounty Attributes(TestMethod()) Access(*Public)
        DclFld Parms    Type(Dictionary(*Of *String,*String)) New()
        DclFld DGList   Type(ASNA.Helpers.DataServices.DataList)
        DclFld json     Type(*String)
        DclFld Result   Type(*Boolean)
        DclFld Rows     Type(*Integer4) 

        Parms.Add("library","Devo")
        Parms.Add("file","County")
        Parms.Add("fields","COUNTY,STATE")
        Parms.Add("rows","-1")

        DclFld db Type(AdgConnection) New("*Public/DG Net Local") 

        db.Open()

        Rows = Convert.ToInt32(Parms["rows"]) 
        DGList = *New ASNA.Helpers.DataServices.DataList(db,Parms["library"],parms["file"],parms["fields"],Rows)
        DGList.AddKey("STATE","TX")
        DGList.AddKey("COUNTY","A")
        DGList.Query = "STATE = '{STATE}' AND COUNTY >= '{COUNTY}'" 
        DGList.IndentJson = *True

        Result = DGList.GetList()
        Assert.IsTrue(Result)  
        If (Result) 
            // Success.
        Else 
            // An error occurred.
        EndIf

        db.Close()

        json = DGList.ListAsJson

        File.WriteAllText("c:\users\roger\documents\counties.json",json)

        Assert.AreEqual(DGList.ResultRowCount,Convert.ToInt32(254))
    EndSr 




EndClass
